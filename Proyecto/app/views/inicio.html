<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
</head>
<body>
    <!-- Contenedor para el header -->
  <div id="header-container"></div>

<div class="app-body">
    <!-- Barra lateral izquierda (con contenido rotado) -->
    <div class="sidebar-left">
        <div class="expedientes-container">
          <div class="expediente nuevo" id="crear-expediente">+ Crear nuevo expediente</div>
        </div>
      </div>
    <!-- Contenido principal -->
    <div class="main-content">
      <h1>Informacion sobre el expediente:</h1>
      <p id="info"></p>
      <p>Estado:</p>
      <div id="uno" hidden>
        
      </div>
      <div id="dos" hidden>

      </div>
      <div id="tres" hidden>

      </div>
      <div id="cuatro" hidden>

      </div>
      <div id="cinco" hidden>

      </div>
      <div id="seis" hidden>
        <h1>Resolución de la tramitación</h1>
        <select name="tipo" id="tipo">
          <option value="" selected disabled>Selecciona un tipo de usuario</option>
          <option value="ayuntamiento">Ayuntamiento</option>
          <option value="aseguradora">Aseguradora</option>
          <option value="perito">Perito</option>
      </select>
      </div>
    </div>
  
    <!-- Barra lateral derecha con círculos -->
    <div class="sidebar-right">
      <div class="step" id="circuloUno"> Recepción de la declaración </div>
      <div class="step" id="circuloDos"> Aclaración de sucesos</div>
      <div class="step" id="circuloTres"> Valoración</div>
      <div class="step" id="circuloCuatro"> Comprovación siniestro</div>
      <div class="step" id="circuloCinco"> Peritaje</div>
      <div class="step" id="circuloSeis"> Resoucion de la tramitacion</div>
    </div>

    <script>
      document.addEventListener('DOMContentLoaded', () => {
        fetch('/mis-expedientes')
          .then(res => {
            if (!res.ok) throw new Error('No se pudo cargar los expedientes');
            return res.json();
          })
          .then(data => {
            const contenedor = document.querySelector('.expedientes-container');
    
            data.forEach((expediente) => {
              const div = document.createElement('div');
              div.className = 'expediente';
              div.textContent = expediente.id_expediente;

              div.addEventListener('click', () => {
                // 1) Quitamos la clase activo de todos
                document.querySelectorAll('.expediente').forEach(el => {
                  el.classList.remove('activo');
                });

                // 2) Guardamos el id del expediente en una cookie
                document.cookie = `id_expediente=${expediente.id_expediente}; path=/; max-age=${60*60}`;

                // 2) La añadimos **solo** al div clicado
                div.classList.add('activo');

                // 3) Rellenamos la info...
                info.innerHTML = `ID: ${expediente.id_expediente}<br>
                  Descripción: ${expediente.descripcion}<br>
                  Matrícula: ${expediente.matricula}<br>
                  DNI cliente: ${expediente.dni_cliente}<br>
                  Fecha creación: ${expediente.fecha_creacion}<br>`;

                  getEstado();
            });

            const btnCrear = document.getElementById('crear-expediente');
              btnCrear.addEventListener('click', () => {
                fetch('/mis-expedientes', {
                  method: 'POST',
                  headers: { 'Content-Type': 'application/json' }
                })
                .then(res => {
                  if (!res.ok) throw new Error('Error creando expediente');
                  return res.json();
                })
                .then(nuevo => {
                  // Añade el nuevo div al principio de la lista
                  const div = document.createElement('div');
                  div.className = 'expediente';
                  div.textContent = nuevo.id_expediente;
                  div.addEventListener('click', () => seleccionarExpediente(nuevo));
                  contenedor.prepend(div);

                  // Opcional: seleccionarlo automáticamente
                  seleccionarExpediente(nuevo);
                })
                .catch(console.error);
              });

  contenedor.appendChild(div);
});
          })
          .catch(err => console.error('Error al cargar expedientes:', err));
      });
      
    </script>

    <script>
      // Aquí adquirimos el tipo de usuario para determinar sus permisos de modificación y estado de la solicitud
      //switch (tipo){

      //}
function getEstado() {
      fetch('/estado-expediente')
  .then(res => {
    if (!res.ok) throw new Error('No hay estado');
    return res.json();
  })
  .then(estado => {

      console.log(estado.nombre_estado);
      switch (estado.nombre_estado){
        case 'Recepción de la declaración':
          document.getElementById('uno').removeAttribute('hidden');
          document.getElementById('circuloUno').classList.add('active');
          break;
        case 'Aclaración de sucesos':
          document.getElementById('dos').removeAttribute('hidden');
          document.getElementById('circuloDos').classList.add('active');
          break;
        case 'Valoración':
          document.getElementById('tres').removeAttribute('hidden');
          document.getElementById('circuloTres').classList.add('active');
          break;
        case 'Comprovación siniestro':
          document.getElementById('cuatro').removeAttribute('hidden');
          document.getElementById('circuloCuatro').classList.add('active');
          break;
        case 'Peritaje':
          document.getElementById('cinco').removeAttribute('hidden');
          document.getElementById('circuloCinco').classList.add('active');
          break;
        case 'Resoución de la tramitación':
          document.getElementById('seis').removeAttribute('hidden');
          document.getElementById('circuloSeis').classList.add('active');
          break;
      }
  })
  .catch(err => console.error(err));
};
    </script>

    <script>
  
</script>

  </div>
  




  <!-- Script corregido -->
  <script>
      fetch('/top.html')  // ¡Atención a la barra inicial!
          .then(response => {
              if (!response.ok) throw new Error('Network response was not ok');
              return response.text();
          })
          .then(html => {
              document.getElementById('header-container').innerHTML = html;
              // Ejecutar scripts del header si existen
              const headerScripts = document.getElementById('header-container').getElementsByTagName('script');
              Array.from(headerScripts).forEach(script => {
                  const newScript = document.createElement('script');
                  newScript.text = script.innerHTML;
                  document.body.appendChild(newScript).parentNode.removeChild(newScript);
              });
          })
          .catch(error => console.error('Error loading header:', error));
  </script>
     <!-- Contenedor para el header -->
     <div id="bottom-container"></div>

     <!-- Script corregido -->
     
     <script>
         fetch('/bottom.html')  // ¡Atención a la barra inicial!
             .then(response => {
                 if (!response.ok) throw new Error('Network response was not ok');
                 return response.text();
             })
             .then(html => {
                 document.getElementById('bottom-container').innerHTML = html;
                 // Ejecutar scripts del header si existen
                 const headerScripts = document.getElementById('bottom-container').getElementsByTagName('script');
                 Array.from(headerScripts).forEach(script => {
                     const newScript = document.createElement('script');
                     newScript.text = script.innerHTML;
                     document.body.appendChild(newScript).parentNode.removeChild(newScript);
                 });
             })
             .catch(error => console.error('Error loading bottom:', error));
     </script>
  <style>
  html, body {
    margin: 0;
    padding: 0;
    height: 100%;
  }

  #header-container {
    height: 80px; /* Ajusta según el alto real de top.html */
  }

  #bottom-container {
    height: 80px; /* Ajusta según el alto real de bottom.html */
  }

  .app-body {
    display: flex;
    height: calc(100% - 160px); /* Resta altura del header y footer */
  }

  .sidebar-left {
    width: 200px;
    background-color: #f5f5f5;
    border-right: 1px solid #ccc;
    padding: 10px;
    overflow-y: auto;
  }

  .expedientes-container {
    display: flex;
    flex-direction: column;
    gap: 10px;
  }

  .expediente {
    background-color: #e0e0e0;
    padding: 10px;
    border: 1px solid #aaa;
    border-radius: 5px;
    cursor: pointer;
    text-align: center;
    transition: background-color 0.2s;
  }

  .expediente:hover {
    background-color: #d0d0d0;
  }

  .expediente.activo {
    background-color: #a3d977;
    font-weight: bold;
  }

  .main-content {
    flex: 1;
    padding: 20px;
    background-color: white;
    border-left: 1px solid #ccc;
    border-right: 1px solid #ccc;
    overflow-y: auto;
  }

  .sidebar-right {
    top:0%;
    width: 200px;
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    gap: 10px;
  }

  .step {
    display: flex;
    width: 85px;
    height: 85px;
    border: 2px solid black;
    border-radius: 50%;
    background-color: white;
    justify-content: center; 
  align-items: center;
  }

  .step.active {
    background-color: #b4f439;
    border: 4px double black;
  }
</style>

</body>
</html>